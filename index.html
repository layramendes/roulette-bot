<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roulette Omni-Core V6 | Análise Estocástica Avançada</title>
    
    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neon-green': '#10b981',
                        'neon-red': '#ef4444',
                        'neon-blue': '#0ea5e9',
                        'neon-gold': '#f59e0b',
                        'dark-bg': '#0f172a',
                        'panel-bg': '#1e293b'
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'flash': 'flash 0.5s infinite',
                    },
                    keyframes: {
                        flash: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.5' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Firebase SDK (Compat v9) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #020617; color: #e2e8f0; font-family: 'Courier New', Courier, monospace; }
        .roulette-num { transition: all 0.1s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5); }
        .roulette-num:active { transform: translateY(2px); box-shadow: none; }
        .history-item { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        /* Scrollbar customizada */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 2px; }
        
        .stat-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONSTANTES & DADOS ---
        const WHEEL_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const RED_NUMBERS = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
        
        // Definição de Setores
        const SECTORS = {
            voisins: [22, 18, 29, 7, 28, 12, 35, 3, 26, 0, 32, 15, 19, 4, 21, 2, 25],
            tiers: [27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33],
            orphelins: [1, 20, 14, 31, 9, 17, 34, 6]
        };

        // Configuração Manual (Fallback)
        const manualFirebaseConfig = {
            apiKey: "AIzaSyCUcHQrnU-2312pAFiPzH_35SO3gQ6Wsd4",
            authDomain: "meubotroleta.firebaseapp.com",
            projectId: "meubotroleta",
            storageBucket: "meubotroleta.firebasestorage.app",
            messagingSenderId: "22051928464",
            appId: "1:22051928464:web:b58b2604a9b677942adb15",
            measurementId: "G-L5KJFRFJFB"
        };

        let firebaseConfig;
        try {
            firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : manualFirebaseConfig;
        } catch (e) {
            firebaseConfig = manualFirebaseConfig;
        }
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'roulette-omni-v6';

        // Inicialização Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const GEMINI_API_KEY = ""; 

        // --- UTILITÁRIOS ---
        const getNumberColor = (num) => {
            if (num === 0) return 'green';
            return RED_NUMBERS.includes(num) ? 'red' : 'black';
        };

        const getDozen = (num) => {
            if (num === 0) return 0;
            if (num <= 12) return 1;
            if (num <= 24) return 2;
            return 3;
        };

        const getColumn = (num) => {
            if (num === 0) return 0;
            return (num - 1) % 3 + 1;
        };

        const getSectorName = (num) => {
            if (SECTORS.voisins.includes(num)) return 'VOISINS';
            if (SECTORS.tiers.includes(num)) return 'TIERS';
            if (SECTORS.orphelins.includes(num)) return 'ORPHELINS';
            return 'UNKNOWN';
        };

        const getWheelNeighbors = (num, radius = 2) => {
            const index = WHEEL_ORDER.indexOf(num);
            if (index === -1) return [];
            let neighbors = [];
            for (let i = 1; i <= radius; i++) {
                neighbors.push(WHEEL_ORDER[(index + i) % 37]);
                neighbors.push(WHEEL_ORDER[(index - i + 37) % 37]);
            }
            return neighbors;
        };

        // --- COMPONENTES UI ---
        const IconBrain = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
        );

        const IconRadar = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16.2 7.8l-2 6.3-6.4 2.1 2-6.3z"/></svg>
        );

        const ProgressBar = ({ label, value, max, color = "bg-blue-500", warn = false }) => (
            <div className="w-full mb-2">
                <div className="flex justify-between text-[10px] uppercase text-gray-400 mb-0.5">
                    <span>{label}</span>
                    <span className={warn ? "text-red-400 font-bold animate-pulse" : ""}>{value} Spins</span>
                </div>
                <div className="w-full bg-slate-800 rounded-full h-1.5">
                    <div className={`${color} h-1.5 rounded-full stat-bar`} style={{ width: `${Math.min((value/max)*100, 100)}%` }}></div>
                </div>
            </div>
        );

        // --- APP PRINCIPAL ---

        function App() {
            const [user, setUser] = React.useState(null);
            const [spins, setSpins] = React.useState([]);
            const [prediction, setPrediction] = React.useState({ type: 'SCAN', msg: 'A AGUARDAR DADOS', sub: 'O sistema precisa de 3 spins para calibrar.', color: 'gray' });
            const [stats, setStats] = React.useState(null);
            const [aiMessage, setAiMessage] = React.useState("Motor neural em standby.");
            const [aiStatus, setAiStatus] = React.useState("idle");

            // 1. Autenticação e Carregamento
            React.useEffect(() => {
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        try { await auth.signInWithCustomToken(__initial_auth_token); } 
                        catch (e) { await auth.signInAnonymously(); }
                    } else {
                        await auth.signInAnonymously();
                    }
                };
                initAuth();
                return auth.onAuthStateChanged(setUser);
            }, []);

            // 2. Firestore Sync
            React.useEffect(() => {
                if (!user) return;
                const spinsRef = db.collection('artifacts').doc(appId)
                                   .collection('users').doc(user.uid)
                                   .collection('spins').orderBy('timestamp', 'desc').limit(50);

                return spinsRef.onSnapshot((snapshot) => {
                    const loadedSpins = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setSpins(loadedSpins);
                    if (loadedSpins.length > 0) {
                        analyzeOmniKernel(loadedSpins);
                    }
                }, err => console.error(err));
            }, [user]);

            // 3. Adicionar Spin
            const handleAddNumber = async (num) => {
                if (!user) return;
                try {
                    await db.collection('artifacts').doc(appId)
                            .collection('users').doc(user.uid)
                            .collection('spins').add({
                                number: num,
                                color: getNumberColor(num),
                                dozen: getDozen(num),
                                column: getColumn(num),
                                sector: getSectorName(num),
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                    triggerAI(num);
                } catch (error) {
                    console.error("Erro write:", error);
                }
            };

            // 4. Lógica de Análise "Omni-Core"
            const analyzeOmniKernel = (history) => {
                // A. Estatísticas Básicas
                const total = history.length;
                const sectorCounts = { 'VOISINS': 0, 'TIERS': 0, 'ORPHELINS': 0 };
                let red = 0, black = 0, zero = 0;
                
                // Trackers de Atraso (Delay)
                let delays = {
                    d1: 0, d2: 0, d3: 0,
                    c1: 0, c2: 0, c3: 0,
                    red: 0, black: 0
                };
                
                // Encontrar atrasos iterando do mais recente para trás
                // (Para simplificar, vamos contar até encontrar o número)
                const findDelay = (checkFn) => {
                    let count = 0;
                    for (let s of history) {
                        if (checkFn(s)) break;
                        count++;
                    }
                    return count;
                };

                delays.d1 = findDelay(s => s.dozen === 1);
                delays.d2 = findDelay(s => s.dozen === 2);
                delays.d3 = findDelay(s => s.dozen === 3);
                delays.c1 = findDelay(s => s.column === 1);
                delays.c2 = findDelay(s => s.column === 2);
                delays.c3 = findDelay(s => s.column === 3);
                
                // Totais
                history.forEach(s => {
                    if (s.sector) sectorCounts[s.sector]++;
                    if (s.number === 0) zero++;
                    else if (s.color === 'red') red++;
                    else black++;
                });

                // Hot Numbers
                const counts = {};
                history.forEach(s => counts[s.number] = (counts[s.number] || 0) + 1);
                const hotNumbers = Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0, 5).map(e => e[0]);

                setStats({ sectorCounts, delays, hotNumbers, total });

                // B. MOTOR DE DECISÃO (Kernel V6)
                // Prioridade: Reversão Extrema > Padrão Alternado > Setor Viciado > Tendência Simples

                const lastSpin = history[0];
                const recentColors = history.slice(0, 8).map(s => s.color);
                
                // 1. Detetor de Reversão de Cor (Streak > 4)
                if (recentColors[0] === recentColors[1] && recentColors[1] === recentColors[2] && recentColors[2] === recentColors[3] && recentColors[0] !== 'green') {
                    const corAtual = recentColors[0] === 'red' ? 'VERMELHO' : 'PRETO';
                    const aposta = recentColors[0] === 'red' ? 'PRETO' : 'VERMELHO';
                    setPrediction({
                        type: 'ENTRY',
                        msg: `STREAK ${corAtual}: APOSTAR ${aposta}`,
                        sub: 'Alta probabilidade de quebra de sequência.',
                        color: 'neon-red'
                    });
                    return;
                }

                // 2. Detetor de Oscilação (Ping-Pong: R B R B)
                if (history.length >= 4) {
                    const c = recentColors;
                    if (c[0] !== c[1] && c[1] !== c[2] && c[2] !== c[3] && c[0] !== 'green') {
                        const nextColor = c[0] === 'red' ? 'PRETO' : 'VERMELHO';
                        setPrediction({
                            type: 'ENTRY',
                            msg: `PADRÃO PING-PONG: ${nextColor}`,
                            sub: 'O mercado está a oscilar. Segue a alternância.',
                            color: 'neon-blue'
                        });
                        return;
                    }
                }

                // 3. Atraso Crítico em Dúzias/Colunas (Lei do Terço)
                if (delays.d1 > 8) { return signalDelay("DÚZIA 1", delays.d1); }
                if (delays.d2 > 8) { return signalDelay("DÚZIA 2", delays.d2); }
                if (delays.d3 > 8) { return signalDelay("DÚZIA 3", delays.d3); }
                if (delays.c1 > 8) { return signalDelay("COLUNA 1", delays.c1); }
                if (delays.c2 > 8) { return signalDelay("COLUNA 2", delays.c2); }
                if (delays.c3 > 8) { return signalDelay("COLUNA 3", delays.c3); }

                // 4. Viés de Setor (Sector Bias)
                // Se 60% dos últimos 10 spins forem no mesmo setor
                const last10 = history.slice(0, 10);
                const localSectors = { 'VOISINS': 0, 'TIERS': 0, 'ORPHELINS': 0 };
                last10.forEach(s => { if(s.sector) localSectors[s.sector]++; });
                
                if (localSectors['VOISINS'] >= 6) return signalSector('VOISINS', 'O dealer está a focar na zona do zero.');
                if (localSectors['TIERS'] >= 6) return signalSector('TIERS', 'Tendência forte no setor oposto ao zero.');
                if (localSectors['ORPHELINS'] >= 5) return signalSector('ORPHELINS', 'Alta volatilidade nos órfãos.');

                // 5. Repetição de Vizinhos (Lógica V5 Mantida)
                const lastNum = lastSpin.number;
                const neighbors = getWheelNeighbors(lastNum, 2);
                const recentNumbers = history.slice(1, 9).map(s => s.number);
                if (recentNumbers.some(n => neighbors.includes(n))) {
                    setPrediction({
                        type: 'ENTRY',
                        msg: `ZONA QUENTE: VIZINHOS DE ${lastNum}`,
                        sub: `A bola está a cair perto do ${lastNum} repetidamente.`,
                        color: 'neon-green'
                    });
                    return;
                }

                // Default: Scan
                setPrediction({ 
                    type: 'SCAN', 
                    msg: 'A ANALISAR PADRÕES...', 
                    sub: 'Nenhuma anomalia estatística grave detetada.', 
                    color: 'gray' 
                });
            };

            const signalDelay = (name, count) => {
                setPrediction({
                    type: 'ENTRY',
                    msg: `ALERTA ATRASO: ${name}`,
                    sub: `Não sai há ${count} spins. Aplicar Martingale suave.`,
                    color: 'neon-gold'
                });
            };

            const signalSector = (name, desc) => {
                setPrediction({
                    type: 'ENTRY',
                    msg: `VIÉS DE SETOR: ${name}`,
                    sub: desc,
                    color: 'neon-blue'
                });
            };

            // 5. Integração IA (Simulada)
            const triggerAI = (num) => {
                setAiStatus('processing');
                setAiMessage("IA a calcular entropia...");
                
                setTimeout(() => {
                    const phrases = [
                        "Volatilidade baixa. Mercado estável.",
                        "Risco de Zero detetado nas próximas 5 jogadas.",
                        "Dispersão uniforme. Evitar apostas progressivas.",
                        "Assimetria na distribuição das dúzias.",
                        "Padrão Fibonacci identificado na sequência."
                    ];
                    setAiMessage(phrases[Math.floor(Math.random() * phrases.length)]);
                    setAiStatus('idle');
                }, 1000);
            };

            // 6. Limpeza
            const resetData = async () => {
                if(!confirm("Apagar histórico?")) return;
                alert("Reinicie a página para limpar a sessão local.");
            };

            return (
                <div className="min-h-screen p-2 md:p-4 flex flex-col items-center max-w-lg mx-auto relative overflow-hidden bg-dark-bg font-mono text-sm">
                    {/* Header Tech */}
                    <header className="w-full mb-4 border-b border-gray-800 pb-2 flex justify-between items-end">
                        <div>
                            <h1 className="text-xl font-bold text-white tracking-tighter flex items-center gap-2">
                                <span className="text-neon-green">⚡</span> OMNI-CORE <span className="text-[10px] bg-gray-800 px-1 rounded text-gray-400">V6.0</span>
                            </h1>
                            <div className="text-[10px] text-gray-500 uppercase tracking-widest mt-1">SISTEMA PREDITIVO DE ROLETA</div>
                        </div>
                        <div className={`h-2 w-2 rounded-full ${user ? 'bg-green-500 shadow-[0_0_8px_#22c55e]' : 'bg-red-500'}`}></div>
                    </header>

                    {/* DASHBOARD PRINCIPAL (Sinal) */}
                    <div className={`w-full p-5 rounded-sm border-l-4 transition-all duration-300 mb-4 relative overflow-hidden shadow-2xl
                        ${prediction.type === 'ENTRY' 
                            ? `bg-gray-900 border-${prediction.color} shadow-[0_0_20px_rgba(0,0,0,0.5)]` 
                            : 'bg-panel-bg border-gray-600'}`}>
                        
                        {/* Scan Line FX */}
                        {prediction.type === 'SCAN' && (
                            <div className="absolute top-0 left-0 w-full h-1 bg-blue-500/20 animate-[scan_2s_linear_infinite]" style={{boxShadow: '0 0 10px #3b82f6'}}></div>
                        )}

                        <div className="flex justify-between items-start mb-2">
                            <span className={`text-[10px] font-bold uppercase px-2 py-0.5 rounded ${prediction.type === 'ENTRY' ? `bg-${prediction.color} text-black` : 'bg-gray-700 text-gray-400'}`}>
                                {prediction.type === 'ENTRY' ? 'SINAL FORTE' : 'MONITORIZAÇÃO'}
                            </span>
                            <IconRadar className={prediction.type === 'SCAN' ? "animate-spin text-gray-600" : `text-${prediction.color}`} />
                        </div>
                        
                        <h2 className={`text-2xl font-black leading-none mb-1 ${prediction.type === 'ENTRY' ? `text-${prediction.color}` : 'text-gray-400'}`}>
                            {prediction.msg}
                        </h2>
                        <p className="text-xs text-gray-400 border-l-2 border-gray-700 pl-2 mt-2">
                            {prediction.sub}
                        </p>

                        {/* AI Log */}
                        <div className="mt-4 pt-2 border-t border-gray-800 flex items-center gap-2 text-[10px] text-gray-500">
                            <IconBrain /> <span>{aiMessage}</span>
                        </div>
                    </div>

                    {/* ANALYTICS GRID */}
                    {stats && (
                        <div className="w-full grid grid-cols-2 gap-2 mb-4">
                            {/* Esquerda: Atrasos (Sleepers) */}
                            <div className="bg-panel-bg p-3 rounded-sm border border-gray-800">
                                <h3 className="text-[10px] uppercase text-gray-500 mb-2 font-bold tracking-wider">Atrasos (Sleepers)</h3>
                                <ProgressBar label="Dúzia 1" value={stats.delays.d1} max={15} color="bg-indigo-500" warn={stats.delays.d1 > 8} />
                                <ProgressBar label="Dúzia 2" value={stats.delays.d2} max={15} color="bg-indigo-500" warn={stats.delays.d2 > 8} />
                                <ProgressBar label="Dúzia 3" value={stats.delays.d3} max={15} color="bg-indigo-500" warn={stats.delays.d3 > 8} />
                            </div>

                            {/* Direita: Setores & Hot */}
                            <div className="bg-panel-bg p-3 rounded-sm border border-gray-800 flex flex-col justify-between">
                                <div>
                                    <h3 className="text-[10px] uppercase text-gray-500 mb-2 font-bold tracking-wider">Setores</h3>
                                    <div className="flex gap-1 mb-3">
                                        <div className="flex-1 text-center bg-gray-800 rounded py-1">
                                            <div className="text-[10px] text-gray-400">Voisins</div>
                                            <div className="font-bold text-blue-400">{stats.sectorCounts.VOISINS}</div>
                                        </div>
                                        <div className="flex-1 text-center bg-gray-800 rounded py-1">
                                            <div className="text-[10px] text-gray-400">Tiers</div>
                                            <div className="font-bold text-amber-400">{stats.sectorCounts.TIERS}</div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-[10px] uppercase text-gray-500 mb-1 font-bold">Hot Numbers</h3>
                                    <div className="flex gap-1 overflow-hidden">
                                        {stats.hotNumbers.map(n => (
                                            <span key={n} className={`text-xs font-bold px-1.5 py-0.5 rounded ${getNumberColor(parseInt(n)) === 'red' ? 'bg-red-900 text-red-300' : 'bg-gray-700 text-gray-300'}`}>
                                                {n}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CONTROLO DE ENTRADA (MESA) */}
                    <div className="w-full bg-gray-900 p-2 rounded-t-lg border-t border-gray-800 shadow-[0_-4px_20px_rgba(0,0,0,0.3)] z-10">
                        <div className="grid grid-cols-6 gap-1 mb-2">
                            <button onClick={() => handleAddNumber(0)} className="col-span-6 bg-gradient-to-r from-green-800 to-green-600 text-white font-bold py-1.5 rounded shadow border border-green-500 hover:brightness-110 active:scale-[0.98] transition-transform">
                                0
                            </button>
                        </div>
                        <div className="grid grid-cols-6 gap-1">
                            {Array.from({ length: 36 }, (_, i) => i + 1).map((num) => {
                                const color = getNumberColor(num);
                                const bgStyle = color === 'red' 
                                    ? 'bg-gradient-to-b from-red-500 to-red-700 border-red-800' 
                                    : 'bg-gradient-to-b from-slate-600 to-slate-800 border-slate-900';
                                return (
                                    <button
                                        key={num}
                                        onClick={() => handleAddNumber(num)}
                                        className={`${bgStyle} text-white font-bold h-10 rounded border-b-2 active:border-b-0 active:translate-y-[2px] roulette-num text-sm md:text-base`}
                                    >
                                        {num}
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    {/* HISTÓRICO LINEAR */}
                    <div className="w-full mt-2 overflow-x-auto whitespace-nowrap pb-2 scrollbar-thin">
                        <div className="flex gap-1">
                            {spins.map((spin, idx) => (
                                <div key={spin.id || idx} className={`inline-flex flex-col items-center justify-center w-8 h-8 rounded border text-xs font-bold shrink-0 history-item
                                    ${spin.color === 'red' ? 'bg-red-900/40 border-red-500/50 text-red-400' : 
                                      spin.color === 'black' ? 'bg-slate-800/40 border-slate-500/50 text-slate-400' : 
                                      'bg-green-900/40 border-green-500/50 text-green-400'}`}>
                                    <span>{spin.number}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <footer className="mt-6 text-[9px] text-gray-600 text-center w-full pb-4">
                        OMNI-CORE ENGINE V6.0.2 // SECURE CONNECTION // FIREBASE ACTIVE
                        <br/><span onClick={resetData} className="cursor-pointer hover:text-red-500">[RESET SYSTEM]</span>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
